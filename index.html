<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HSK1 Trainer v2 · 中文→ไทย</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#0f172a">
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900">
    <div id="root"></div>

    <script type="module">
      import React, { useEffect, useMemo, useRef, useState } from "https://esm.sh/react@18?dev";
      import { createRoot } from "https://esm.sh/react-dom@18/client?dev";
      import { pinyin as toPinyin } from "https://esm.sh/pinyin-pro@3";

      const Category = {
        Travel: "การท่องเที่ยว",
        Transit: "การเดินทาง",
        Shopping: "ช็อปปิ้ง",
        Restaurant: "เข้าร้านอาหาร",
        Cafe: "ร้านกาแฟ",
      };

      function getPinyinForSentence(sentence) {
        try { return toPinyin(sentence, { toneType: 'mark', type: 'array' }).join(' '); }
        catch { return sentence; }
      }

      function editDistance(a, b) {
        const dp = Array.from({ length: a.length + 1 }, () => new Array(b.length + 1).fill(0));
        for (let i = 0; i <= a.length; i++) dp[i][0] = i;
        for (let j = 0; j <= b.length; j++) dp[0][j] = j;
        for (let i = 1; i <= a.length; i++) {
          for (let j = 1; j <= b.length; j++) {
            const cost = a[i - 1] === b[j - 1] ? 0 : 1;
            dp[i][j] = Math.min(dp[i - 1][j] + 1, dp[i][j - 1] + 1, dp[i - 1][j - 1] + cost);
          }
        }
        return dp[a.length][b.length];
      }

      function similarity(a, b) {
        try {
          const pa = toPinyin(a, { toneType: 'mark', type: 'array' }).join(' ').toLowerCase();
          const pb = toPinyin(b, { toneType: 'mark', type: 'array' }).join(' ').toLowerCase();
          const d = editDistance(pa, pb);
          const maxLen = Math.max(pa.length, pb.length) || 1;
          return 1 - d / maxLen;
        } catch { return 0; }
      }

      function normalizeThai(s) {
        return s.toLowerCase()
          .replace(/[\sๆ…!?？、,.。]/g, " ")
          .replace(/ครับ|ค่ะ|คะ|นะ|หน่อย|ด้วย|หน่อยนะ|ที/g, "")
          .replace(/หรือเปล่า|หรือป่าว|หรือเปล่|หรือป่าว/g, "ไหม")
          .replace(/ได้ป่าว|ได้ปะ|ได้มั้ย|ไหมมั้ย/g, "ได้ไหม")
          .replace(/อยู่มั้ย/g, "อยู่ไหม")
          .replace(/ที่นี่|ตรงนี้/g, "นี่")
          .replace(/แถวนี้/g, "ที่นี่")
          .replace(/เท่าไหร่|เท่าไร/g, "เท่าไหร่")
          .replace(/หนึ่ง/g, "1").replace(/สอง/g, "2").replace(/สาม/g, "3")
          .replace(/\s+/g, " ").trim();
      }

      function isThaiAnswerCorrect(input, targets) {
        const nor = normalizeThai(input);
        let best = ""; let bestScore = Infinity;
        for (const t of targets) {
          const nt = normalizeThai(t);
          const d = editDistance(nor, nt);
          if (d < bestScore) { bestScore = d; best = t; }
        }
        const maxLen = Math.max(nor.length, normalizeThai(best).length) || 1;
        const ratio = 1 - bestScore / maxLen;
        return { ok: ratio >= 0.7, best, score: ratio };
      }

      let __ttsVoice = null;
      function initVoices() {
        if (!("speechSynthesis" in window)) return;
        const pickVoice = () => {
          const vs = window.speechSynthesis.getVoices?.() || [];
          const zh = vs.find(v => /zh|cmn|Chinese|Mandarin/i.test(v.lang + " " + v.name));
          __ttsVoice = zh || vs.find(v => /zh/i.test(v.lang)) || null;
        };
        pickVoice();
        window.speechSynthesis.onvoiceschanged = pickVoice;
      }
      function speakZH(text) {
        if (!("speechSynthesis" in window)) return alert("อุปกรณ์นี้ไม่รองรับเสียงอ่าน (SpeechSynthesis)");
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = "zh-CN";
        if (__ttsVoice) utter.voice = __ttsVoice;
        utter.rate = 0.95;
        try { window.speechSynthesis.cancel(); window.speechSynthesis.speak(utter); }
        catch { alert("ไม่สามารถเล่นเสียงได้ ลองอนุญาตเสียง/รีโหลดหน้า แล้วกดปุ่มอีกครั้ง"); }
      }

      function useSpeechRecognition(onResult) {
        const [supported, setSupported] = React.useState(false);
        const [error, setError] = React.useState(null);
        const recRef = React.useRef(null);
        React.useEffect(() => {
          const SR = window.webkitSpeechRecognition || window.SpeechRecognition;
          if (SR && window.isSecureContext) {
            setSupported(true);
            const rec = new SR();
            rec.lang = "zh-CN";
            rec.interimResults = false;
            rec.maxAlternatives = 1;
            rec.onerror = (e) => setError(e?.error || "mic error");
            recRef.current = rec;
          } else { setSupported(false); }
        }, []);
        const start = () => {
          if (!recRef.current) return;
          try {
            recRef.current.onresult = (e) => onResult(e.results[0][0].transcript);
            recRef.current.start();
          } catch (e) { setError("เริ่มไมค์ไม่สำเร็จ: " + (e?.message || e)); }
        };
        const stop = () => recRef.current?.stop?.();
        return { supported, start, stop, error };
      }

      const STORAGE_KEY = "hsk1_th_trainer_v2_static";
      const rand = (n) => Math.floor(Math.random() * n);
      const pick = (arr) => arr[rand(arr.length)];

      const LOCATIONS = [
        { zh: "洗手间", th: "ห้องน้ำ" },
        { zh: "地铁站", th: "สถานีรถไฟใต้ดิน" },
        { zh: "火车站", th: "สถานีรถไฟ" },
        { zh: "机场", th: "สนามบิน" },
        { zh: "酒店", th: "โรงแรม" },
        { zh: "银行", th: "ธนาคาร" },
        { zh: "商店", th: "ร้านค้า" },
        { zh: "超市", th: "ซูเปอร์มาร์เก็ต" },
      ];
      const FOOD = [
        { zh: "米饭", th: "ข้าวสวย" },
        { zh: "面条", th: "ก๋วยเตี๋ยว" },
        { zh: "水", th: "น้ำ" },
        { zh: "茶", th: "ชา" },
        { zh: "咖啡", th: "กาแฟ" },
        { zh: "牛奶", th: "นม" },
      ];

      function timeTH(z) {
        const m = { "今天":"วันนี้", "明天早上":"พรุ่งนี้เช้า", "晚上":"ตอนเย็น", "现在":"ตอนนี้", "中午":"ตอนเที่ยง", "周末":"วันหยุดสุดสัปดาห์" };
        return m[z] || "";
      }
      function placeTH(z) {
        const m = { "机场":"สนามบิน", "火车站":"สถานีรถไฟ", "地铁站":"สถานีรถไฟใต้ดิน", "商场":"ห้าง", "商店":"ร้านค้า", "超市":"ซูเปอร์มาร์เก็ต", "饭店":"ร้านอาหาร", "咖啡店":"ร้านกาแฟ", "图书馆":"ห้องสมุด", "银行":"ธนาคาร", "酒店":"โรงแรม" };
        return m[z] || z;
      }
      function dishTH(z){ const m = { "米饭":"ข้าวสวย", "面条儿":"ก๋วยเตี๋ยว", "鸡蛋":"ไข่" }; return m[z] || z; }

      function makeDirectionsTemplates() {
        const base = [];
        for (const loc of LOCATIONS) {
          const zh1 = `请问，${loc.zh}在哪里？`;
          base.push({ id: crypto.randomUUID(), zh: zh1, thAccept: [ `ขอถามหน่อย ${loc.th}อยู่ที่ไหน`, `${loc.th}อยู่ที่ไหน`, `${loc.th}อยู่ตรงไหน` ], words: [ { hanzi: "请问", glossTH: "ขอถามหน่อย" }, { hanzi: loc.zh, glossTH: loc.th }, { hanzi: "在", glossTH: "อยู่" }, { hanzi: "哪里", glossTH: "ที่ไหน" } ], category: Category.Travel });

          const zh2 = `${loc.zh}在这里吗？`;
          base.push({ id: crypto.randomUUID(), zh: zh2, thAccept: [ `${loc.th}อยู่ที่นี่ไหม`, `${loc.th}อยู่นี่ไหม`, `${loc.th}อยู่แถวนี้หรือเปล่า` ], words: [ { hanzi: loc.zh, glossTH: loc.th }, { hanzi: "在", glossTH: "อยู่" }, { hanzi: "这里", glossTH: "ที่นี่" }, { hanzi: "吗", glossTH: "ไหม" } ], category: Category.Transit });
        }
        return base;
      }

      function makeShoppingTemplates() {
        const items = ["水","茶","米饭","面条","咖啡","牛奶"].map(zh => ({ zh, th: FOOD.find(f=>f.zh===zh)?.th || "" }));
        const out = [];
        for (const it of items) {
          const n = pick(["一","两","三"]);
          const zh1 = `我想要${n}杯${it.zh}。`;
          out.push({ id: crypto.randomUUID(), zh: zh1, thAccept: [ `ฉันต้องการ${it.th}${n==="一"?"หนึ่ง":n==="两"?"สอง":"สาม"}แก้ว`, `ขอ${it.th}${n==="一"?"1":n==="两"?"2":"3"}แก้ว`, `เอา${it.th}${n==="一"?"หนึ่ง":n==="两"?"สอง":"สาม"}แก้ว` ], words: [ { hanzi: "我", glossTH: "ฉัน" }, { hanzi: "想要", glossTH: "อยากได้/ต้องการ" }, { hanzi: n, glossTH: n==="一"?"หนึ่ง":n==="两"?"สอง":"สาม" }, { hanzi: "杯", glossTH: "แก้ว" }, { hanzi: it.zh, glossTH: it.th } ], category: Category.Cafe });

          const zh2 = `${it.zh}多少钱？`;
          out.push({ id: crypto.randomUUID(), zh: zh2, thAccept: [ `${it.th}ราคาเท่าไหร่`, `เท่าไหร่${it.th}`, `${it.th}เท่าไร` ], words: [ { hanzi: it.zh, glossTH: it.th }, { hanzi: "多少", glossTH: "เท่าไหร่" }, { hanzi: "钱", glossTH: "เงิน/ราคา" } ], category: Category.Shopping });
        }
        return out;
      }

      function makeRestaurantTemplates() {
        const out = [];
        const dishes = ["米饭", "面条"];
        for (const d of dishes) {
          const zh = `请给我们一份${d}。`;
          out.push({ id: crypto.randomUUID(), zh, thAccept: ["ขอ"+(d==="米饭"?"ข้าวสวย":"ก๋วยเตี๋ยว")+"หนึ่งที่ให้พวกเรา", `ขอ${d==="米饭"?"ข้าวสวย":"ก๋วยเตี๋ยว"} 1 ที่`, `เอา${d==="米饭"?"ข้าวสวย":"ก๋วยเตี๋ยว"}หนึ่งจาน`], words: [ { hanzi: "请", glossTH: "กรุณา/ขอ" }, { hanzi: "给", glossTH: "ให้" }, { hanzi: "我们", glossTH: "พวกเรา" }, { hanzi: "一", glossTH: "หนึ่ง" }, { hanzi: "份", glossTH: "ที่/ชุด" }, { hanzi: d, glossTH: d==="米饭"?"ข้าวสวย":"ก๋วยเตี๋ยว" } ], category: Category.Restaurant });
        }
        const zh2 = `请给我菜单。`;
        out.push({ id: crypto.randomUUID(), zh: zh2, thAccept: ["ขอเมนูหน่อย","ขอดูเมนู","ขอเมนูค่ะ","ขอเมนูครับ"], words: [ { hanzi: "请", glossTH: "กรุณา/ขอ" }, { hanzi: "给", glossTH: "ให้" }, { hanzi: "我", glossTH: "ฉัน" }, { hanzi: "菜单", glossTH: "เมนู" } ], category: Category.Restaurant });
        return out;
      }

      function makeHarderTemplates() {
        const out = [];
        const times = ["今天","明天早上","晚上","现在","中午","周末"];
        const places = ["机场","火车站","地铁站","商场","商店","超市","饭店","咖啡店","图书馆","银行","酒店"];
        const items = [ { zh: "面包", th: "ขนมปัง" }, { zh: "牛奶", th: "นม" }, { zh: "鸡蛋", th: "ไข่" }, { zh: "水", th: "น้ำ" }, { zh: "咖啡", th: "กาแฟ" }, { zh: "衣服", th: "เสื้อผ้า" } ];
        const yesnoPatterns = [
          { zh: (s) => `${s}，是不是？`, th: (t) => `${t}ใช่ไหม` },
          { zh: (s) => `${s}，好不好？`, th: (t) => `${t}ดีไหม` },
          { zh: (s) => `能不能${s}？`, th: (t) => `ทำ${t}ได้ไหม` },
          { zh: (s) => `要不要${s}？`, th: (t) => `เอา${t}ไหม` },
        ];

        for (const pl of places.slice(0,6)) {
          const zh = `因为${pl}很远，所以我们要打车。`;
          out.push({ id: crypto.randomUUID(), zh, thAccept: [ `เพราะ${placeTH(pl)}ไกล จึงพวกเราต้องเรียกแท็กซี่`, `เพราะ${placeTH(pl)}อยู่ไกลเลยต้องนั่งแท็กซี่` ], words: [ { hanzi: "因为", glossTH: "เพราะ" }, { hanzi: pl, glossTH: placeTH(pl) }, { hanzi: "很远", glossTH: "ไกลมาก" }, { hanzi: "所以", glossTH: "ดังนั้น/จึง" }, { hanzi: "我们", glossTH: "พวกเรา" }, { hanzi: "要", glossTH: "ต้อง/จะ" }, { hanzi: "打车", glossTH: "เรียกแท็กซี่" } ], category: Category.Transit });
        }

        for (const t of times) {
          for (const it of items) {
            const base = `在超市买${it.zh}`;
            for (const pat of yesnoPatterns) {
              out.push({ id: crypto.randomUUID(), zh: pat.zh(`${t}我们${base}`), thAccept: [ `${timeTH(t)}พวกเรา${pat.th(`ไปซื้อ${it.th}`)}ที่ซูเปอร์มาร์เก็ต`, `${timeTH(t)}ไปซื้อ${it.th}ที่ซูเปอร์มาร์เก็ตกันไหม` ], words: [ { hanzi: t, glossTH: timeTH(t) }, { hanzi: "我们", glossTH: "พวกเรา" }, { hanzi: "在", glossTH: "ที่/อยู่" }, { hanzi: "超市", glossTH: "ซูเปอร์มาร์เก็ต" }, { hanzi: "买", glossTH: "ซื้อ" }, { hanzi: it.zh, glossTH: it.th } ], category: Category.Shopping });
            }
          }
        }

        for (const it1 of items.slice(0,3)) {
          for (const it2 of items.slice(3,6)) {
            const zh = `我想要一份${it1.zh}和一杯${it2.zh}，但是不要太贵。`;
            out.push({ id: crypto.randomUUID(), zh, thAccept: [ `ฉันอยากได้${it1.th}หนึ่งที่และ${it2.th}หนึ่งแก้ว แต่ไม่เอาแพงมาก`, `ขอ${it1.th} 1 ที่กับ${it2.th} 1 แก้ว แต่ขอไม่แพง` ], words: [ { hanzi: "我", glossTH: "ฉัน" }, { hanzi: "想要", glossTH: "อยากได้" }, { hanzi: "一份", glossTH: "หนึ่งที่" }, { hanzi: it1.zh, glossTH: it1.th }, { hanzi: "和", glossTH: "และ" }, { hanzi: "一杯", glossTH: "หนึ่งแก้ว" }, { hanzi: it2.zh, glossTH: it2.th }, { hanzi: "但是", glossTH: "แต่" }, { hanzi: "不要", glossTH: "ไม่เอา" }, { hanzi: "太贵", glossTH: "แพงเกินไป" } ], category: Category.Cafe });
          }
        }

        for (const pl of places) {
          const zh = `请问，从这里到${pl}怎么走？`;
          out.push({ id: crypto.randomUUID(), zh, thAccept: [ `ขอถามหน่อย จากที่นี่ไป${placeTH(pl)}ไปยังไง`, `จากตรงนี้จะไป${placeTH(pl)}ยังไง` ], words: [ { hanzi: "请问", glossTH: "ขอถามหน่อย" }, { hanzi: "从这里", glossTH: "จากที่นี่" }, { hanzi: "到", glossTH: "ถึง" }, { hanzi: pl, glossTH: placeTH(pl) }, { hanzi: "怎么走", glossTH: "ไปยังไง" } ], category: Category.Travel });
        }

        for (const d of ["米饭","面条儿","鸡蛋"]) {
          out.push({ id: crypto.randomUUID(), zh: `服务员，能不能给我们两份${d}？`, thAccept: [ `พนักงาน ช่วยเอา${dishTH(d)}สองที่ให้พวกเราได้ไหม`, `ขอ${dishTH(d)} 2 ที่ให้พวกเราได้ไหม` ], words: [ { hanzi: "服务员", glossTH: "พนักงานเสิร์ฟ" }, { hanzi: "能不能", glossTH: "ได้ไหม" }, { hanzi: "给我们", glossTH: "ให้พวกเรา" }, { hanzi: "两份", glossTH: "สองที่" }, { hanzi: d, glossTH: dishTH(d) } ], category: Category.Restaurant });
        }

        let i = 0;
        while (out.length < 200) {
          const t = times[i % times.length];
          const pl = places[i % places.length];
          out.push({ id: crypto.randomUUID(), zh: `${t}我们在${pl}见面，好不好？`, thAccept: [ `${timeTH(t)}พวกเราไปนัดเจอกันที่${placeTH(pl)}ดีไหม`, `${timeTH(t)}เจอกันที่${placeTH(pl)}ได้ไหม` ], words: [ { hanzi: t, glossTH: timeTH(t) }, { hanzi: "我们", glossTH: "พวกเรา" }, { hanzi: "在", glossTH: "ที่" }, { hanzi: pl, glossTH: placeTH(pl) }, { hanzi: "见面", glossTH: "เจอกัน" }, { hanzi: "好不好", glossTH: "ดีไหม" } ], category: Category.Transit });
          i++; if (i > 600) break;
        }
        return out;
      }

      function generateAll() {
        const base = [ ...makeDirectionsTemplates(), ...makeShoppingTemplates(), ...makeRestaurantTemplates() ];
        const seen = new Set();
        const base100 = [];
        for (const it of base) { if (!seen.has(it.zh)) { seen.add(it.zh); base100.push(it); } if (base100.length >= 100) break; }
        const harder200 = makeHarderTemplates();
        return [...base100, ...harder200].slice(0, 300);
      }

      function usePersistent(key, init) {
        const [val, setVal] = React.useState(() => { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : init; });
        React.useEffect(() => { localStorage.setItem(key, JSON.stringify(val)); }, [key, val]);
        return [val, setVal];
      }

      function App() {
        const [dataset, setDataset] = usePersistent(STORAGE_KEY + ":data", generateAll());
        const [category, setCategory] = usePersistent(STORAGE_KEY + ":cat", "ทั้งหมด");
        const [idx, setIdx] = usePersistent(STORAGE_KEY + ":idx", 0);
        const [answerTH, setAnswerTH] = React.useState("");
        const [revealed, setRevealed] = React.useState(false);
        const [ask, setAsk] = React.useState("");
        const [feedback, setFeedback] = React.useState(null);
        const [micText, setMicText] = React.useState("");
        const { supported: micOK, start: micStart, error: micErr } = useSpeechRecognition((t) => setMicText(t));

        const filtered = React.useMemo(() => (category === "ทั้งหมด" ? dataset : dataset.filter((x) => x.category === category)), [dataset, category]);
        const item = filtered[(idx % filtered.length + filtered.length) % filtered.length];

        React.useEffect(() => { setAnswerTH(""); setRevealed(false); setFeedback(null); setMicText(""); initVoices(); }, [idx, category]);

        function checkThai() {
          const res = isThaiAnswerCorrect(answerTH, item.thAccept);
          setFeedback(res.ok ? `✅ ถูกต้อง (ความใกล้เคียง ${(res.score * 100).toFixed(0)}%)` : `❌ ยังไม่ค่อยตรง ลองใหม่อีกครั้ง (ใกล้ ${(res.score * 100).toFixed(0)}%)\nตัวอย่างคำตอบ: ${res.best}`);
        }
        function exportJSON() {
          const blob = new Blob([JSON.stringify(dataset, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "hsk1_sentences_th_v2.json"; a.click();
        }
        function importJSON(ev) {
          const f = ev.target.files?.[0]; if (!f) return;
          const reader = new FileReader(); reader.onload = () => {
            try { const arr = JSON.parse(String(reader.result)); if (Array.isArray(arr) && arr[0]?.zh) setDataset(arr); }
            catch { alert("ไฟล์ไม่ถูกต้อง"); }
          }; reader.readAsText(f);
        }

        return (
          React.createElement("div", {className:"mx-auto max-w-5xl px-4 py-6 grid gap-4"},
            React.createElement("header", {className:"-mt-6 mb-2"},
              React.createElement("h1", {className:"text-xl sm:text-2xl font-semibold"}, "HSK1 Trainer v2 · 中文→ไทย")
            ),
            React.createElement("div", {className:"flex flex-wrap items-center gap-2"},
              React.createElement("span", {className:"text-sm"}, "หมวดหมู่:"),
              ...["ทั้งหมด", Category.Travel, Category.Transit, Category.Shopping, Category.Restaurant, Category.Cafe].map((c) =>
                React.createElement("button", {key:c, onClick:() => setCategory(c), className:`px-3 py-1.5 rounded-full border ${category===c?"bg-slate-900 text-white":"bg-white hover:bg-slate-50"}`}, c)
              ),
              React.createElement("span", {className:"ml-auto text-sm text-slate-500"}, filtered.length, " ข้อ"),
              React.createElement("div", {className:"ml-2 flex gap-2 items-center"},
                React.createElement("label", {className:"text-sm cursor-pointer"}, "นำเข้า JSON",
                  React.createElement("input",{type:"file",accept:"application/json",className:"hidden",onChange:importJSON})
                ),
                React.createElement("button",{onClick:exportJSON,className:"px-3 py-1.5 rounded-xl bg-slate-900 text-white shadow"},"ส่งออก")
              )
            ),
            React.createElement("div", {className:"grid gap-3 rounded-2xl border p-4 shadow-sm bg-white/60"},
              React.createElement("div", {className:"flex items-start justify-between gap-2"},
                React.createElement("div", null,
                  React.createElement("div", {className:"text-sm text-slate-500"}, "ประโยคภาษาจีน"),
                  React.createElement("div", {className:"text-2xl sm:text-3xl font-medium tracking-wide"}, item.zh),
                  revealed && React.createElement("div", {className:"text-sm text-slate-500 mt-1 select-text"}, getPinyinForSentence(item.zh))
                ),
                React.createElement("div", {className:"flex gap-2"},
                  React.createElement("button", {onClick:() => speakZH(item.zh), className:"px-3 py-1.5 rounded-xl border", disabled:!("speechSynthesis" in window)}, "ฟังเสียง"),
                  React.createElement("button", {onClick:() => setRevealed(v=>!v), className:"px-3 py-1.5 rounded-xl border"}, revealed?"ซ่อนคำเฉลย":"เฉลยคำศัพท์")
                )
              ),
              revealed && React.createElement("div", {className:"grid gap-1 sm:grid-cols-2 lg:grid-cols-3"},
                ...item.words.map((w,i) =>
                  React.createElement("div", {key:i, className:"rounded-xl border p-3 bg-white"},
                    React.createElement("div", {className:"text-lg"}, w.hanzi),
                    React.createElement("div", {className:"text-sm text-slate-500"}, toPinyin(w.hanzi, { toneType: 'mark', type: 'array' }).join(' ')),
                    React.createElement("div", {className:"text-sm"}, "ความหมาย: ", w.glossTH),
                    React.createElement("button", {onClick:() => speakZH(w.hanzi), className:"mt-2 text-xs px-2 py-1 rounded-lg border", disabled:!("speechSynthesis" in window)}, "ฟังคำนี้")
                  )
                )
              ),
              React.createElement("div", {className:"grid gap-2"},
                React.createElement("label",{className:"text-sm text-slate-700"},"พิมพ์คำแปลเป็นภาษาไทย"),
                React.createElement("input",{value:answerTH,onChange:e=>setAnswerTH(e.target.value),placeholder:"เช่น: ขอถามหน่อย ห้องน้ำอยู่ที่ไหน",className:"w-full rounded-xl border px-3 py-2"}),
                React.createElement("div",{className:"flex gap-2"},
                  React.createElement("button",{onClick:checkThai,className:"px-4 py-2 rounded-xl bg-slate-900 text-white"},"ตรวจคำตอบ"),
                  React.createElement("button",{onClick:()=>setAnswerTH(pick(item.thAccept)),className:"px-4 py-2 rounded-xl border"},"ใส่ตัวอย่างคำตอบ"),
                  React.createElement("button",{onClick:()=>{ const i = filtered.indexOf(item); const ni = (i - 1 + filtered.length) % filtered.length; const tgt = filtered[ni]; const di = dataset.indexOf(tgt); localStorage.setItem(STORAGE_KEY+":idx", JSON.stringify(di)); location.reload(); },className:"ml-auto px-3 py-2 rounded-xl border"},"ก่อนหน้า"),
                  React.createElement("button",{onClick:()=>{ const i = filtered.indexOf(item); const ni = (i + 1) % filtered.length; const tgt = filtered[ni]; const di = dataset.indexOf(tgt); localStorage.setItem(STORAGE_KEY+":idx", JSON.stringify(di)); location.reload(); },className:"px-3 py-2 rounded-xl border"},"ข้อต่อไป")
                ),
                feedback && React.createElement("div",{className:"text-sm whitespace-pre-wrap"}, feedback)
              ),
              React.createElement("div",{className:"grid gap-2 border-t pt-4"},
                React.createElement("div",{className:"flex items-center gap-2"},
                  React.createElement("div",{className:"font-medium"},"ฝึกพูดประโยคนี้"),
                  React.createElement("div",{className:"text-xs text-slate-500"},"(จีนกลาง)")
                ),
                React.createElement("div",{className:"flex gap-2 items-center"},
                  React.createElement("button",{disabled:!micOK,onClick:()=>{initVoices();micStart();},className:`px-3 py-2 rounded-xl ${true?"border":""}`}, micOK?"เริ่มอัดไมค์":"ไมค์ไม่พร้อม (ต้องใช้ HTTPS/Chrome)"),
                  React.createElement("button",{onClick:()=>setMicText(""),className:"px-3 py-2 rounded-xl border"},"ล้างข้อความ"),
                  React.createElement("button",{onClick:()=>speakZH(item.zh),className:"px-3 py-2 rounded-xl border",disabled:!("speechSynthesis" in window)},"ฟังอีกครั้ง"),
                  micErr && React.createElement("span",{className:"text-xs text-red-600"}, String(micErr))
                ),
                React.createElement("div",{className:"rounded-xl border p-3 bg-white min-h-[44px]"}, micText || React.createElement("span",{className:"text-slate-400"},"(คำที่ได้จากไมค์จะแสดงที่นี่)")),
                micText && React.createElement("div",{className:"text-sm"},"คะแนนความใกล้เคียง: ", (similarity(micText, item.zh)*100).toFixed(0), "%")
              )
            ),
            React.createElement("div",{className:"grid gap-2 rounded-2xl border p-4 shadow-sm"},
              React.createElement("div",{className:"font-medium"},"ถามสมชาย (AI) เพิ่มเติมเกี่ยวกับประโยคนี้"),
              React.createElement("input",{placeholder:"ถามได้เลย เช่น ทำไมใช้ 在 哪里",className:"w-full rounded-xl border px-3 py-2"}),
              React.createElement("div",{className:"text-xs text-slate-500"}, "*ปุ่มนี้ให้คำอธิบายอย่างย่อแบบออฟไลน์ หากต้องการคุยกับ AI เต็มรูปแบบ ใช้แชตหน้าหลักคู่ไปด้วย")
            ),
            React.createElement("div",{className:"grid gap-2 text-xs text-slate-500"},
              React.createElement("div",null,"หมายเหตุ: พินอินสร้างอัตโนมัติด้วย pinyin-pro ครอบคลุมคำใน HSK1 ทั้งหมด"),
              React.createElement("div",null,"เคล็ดลับ: คุณสามารถส่งออก/นำเข้า JSON เพื่อปรับชุดประโยคได้")
            )
          )
        );
      }

      createRoot(document.getElementById("root")).render(React.createElement(App));
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(()=>{});
        });
      }
    </script>
  </body>
</html>
